local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "TriquetraSweepLoader"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    bg.Parent = gui

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.7)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamMedium
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local base = Instance.new("ImageLabel")
    base.AnchorPoint = Vector2.new(0.5, 0.5)
    base.Position = UDim2.fromScale(0.5, 0.45)
    base.Size = UDim2.new(0, 200, 0, 200)
    base.BackgroundTransparency = 1
    base.Image = "rbxassetid://18671087986"
    base.ImageColor3 = Color3.fromRGB(60, 60, 60)
    base.Parent = bg

    local blue = Instance.new("ImageLabel")
    blue.AnchorPoint = Vector2.new(0.5, 0.5)
    blue.Position = UDim2.fromScale(0.5, 0.45)
    blue.Size = UDim2.new(0, 200, 0, 200)
    blue.BackgroundTransparency = 1
    blue.Image = "rbxassetid://18671087986"
    blue.ImageColor3 = Color3.fromRGB(0, 170, 255)
    blue.Parent = bg

    local mask = Instance.new("Frame")
    mask.AnchorPoint = Vector2.new(0.5, 0.5)
    mask.Position = UDim2.fromScale(0.5, 0.5)
    mask.Size = UDim2.new(1.2, 0, 1.2, 0)
    mask.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    mask.BackgroundTransparency = 0
    mask.Parent = blue

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = mask

    blue.ClipsDescendants = true

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(mask, TweenInfo.new(1.2, Enum.EasingStyle.Linear), {Rotation = mask.Rotation + 180}):Play()
            task.wait(1.2)
        end
    end)

    local function FadeOut()
        TweenService:Create(bg, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {BackgroundTransparency = 1}):Play()
        TweenService:Create(label, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {TextTransparency = 1}):Play()
        TweenService:Create(base, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {ImageTransparency = 1}):Play()
        TweenService:Create(blue, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {ImageTransparency = 1}):Play()
        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

return CreateLoaderScreen
