local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "HubLoading"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    bg.Parent = gui

    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(106,145,19)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20,21,23))
    })
    gradient.Rotation = 0
    gradient.Parent = bg

    TweenService:Create(
        gradient,
        TweenInfo.new(22, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1),
        {Rotation = 360}
    ):Play()

    local diamond = Instance.new("Frame")
diamond.AnchorPoint = Vector2.new(0.5, 0.5)
diamond.Position = UDim2.fromScale(0.5, 0.45)
diamond.Size = UDim2.new(0, 80, 0, 80)
diamond.BackgroundTransparency = 1
diamond.Parent = bg

local outline = Instance.new("Frame")
outline.AnchorPoint = Vector2.new(0.5, 0.5)
outline.Position = UDim2.fromScale(0.5, 0.5)
outline.Size = UDim2.new(1, 0, 1, 0)
outline.BackgroundTransparency = 1
outline.BorderSizePixel = 2
outline.BorderColor3 = Color3.fromRGB(150, 255, 120)
outline.Rotation = 45
outline.Parent = diamond

local glow = Instance.new("UIStroke")
glow.Thickness = 2
glow.Color = Color3.fromRGB(150, 255, 120)
glow.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
glow.Parent = outline

task.spawn(function()
    while diamond.Parent do
        TweenService:Create(
            outline,
            TweenInfo.new(0.9, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
            {Rotation = 135}
        ):Play()
        task.wait(0.9)

        TweenService:Create(
            outline,
            TweenInfo.new(0.9, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
            {Rotation = 45}
        ):Play()
        task.wait(0.9)
    end
end)

    local backGrad = Instance.new("UIGradient")
    backGrad.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(60,60,60)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20,20,20))
    }
    backGrad.Rotation = 90
    backGrad.Parent = backFace

    local frontFace = Instance.new("Frame")
    frontFace.AnchorPoint = Vector2.new(0.5, 0.5)
    frontFace.Position = UDim2.fromScale(0.5, 0.5)
    frontFace.Size = UDim2.new(1, 0, 1, 0)
    frontFace.BackgroundColor3 = Color3.fromRGB(150, 255, 120)
    frontFace.BackgroundTransparency = 0.15
    frontFace.BorderSizePixel = 0
    frontFace.Rotation = 45
    frontFace.Parent = diamond

    local frontGrad = Instance.new("UIGradient")
    frontGrad.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(180,255,150)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(80,150,70))
    }
    frontGrad.Rotation = -90
    frontGrad.Parent = frontFace

    local core = Instance.new("Frame")
    core.AnchorPoint = Vector2.new(0.5, 0.5)
    core.Position = UDim2.fromScale(0.5, 0.5)
    core.Size = UDim2.new(0.5, 0, 0.5, 0)
    core.BackgroundColor3 = Color3.fromRGB(150, 255, 120)
    core.BackgroundTransparency = 0.7
    core.BorderSizePixel = 0
    core.Rotation = 45
    core.Parent = diamond

    local shine = Instance.new("Frame")
    shine.AnchorPoint = Vector2.new(0.5, 0.5)
    shine.Position = UDim2.fromScale(0.5, 0.5)
    shine.Size = UDim2.new(1.3, 0, 1.3, 0)
    shine.BackgroundTransparency = 1
    shine.Parent = diamond

    local shineGrad = Instance.new("UIGradient")
    shineGrad.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255,255,255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255,255,255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255,255,255))
    }
    shineGrad.Transparency = NumberSequence.new{
        NumberSequenceKeypoint.new(0, 1),
        NumberSequenceKeypoint.new(0.5, 0.15),
        NumberSequenceKeypoint.new(1, 1)
    }
    shineGrad.Rotation = 45
    shineGrad.Parent = shine

    task.spawn(function()
        while shine.Parent do
            TweenService:Create(
                shineGrad,
                TweenInfo.new(1.8, Enum.EasingStyle.Sine),
                {Offset = Vector2.new(1, 0)}
            ):Play()
            task.wait(1.8)
            shineGrad.Offset = Vector2.new(-1, 0)
            task.wait(0.1)
        end
    end)

    task.spawn(function()
        while diamond.Parent do
            TweenService:Create(frontFace, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 135}):Play()
            TweenService:Create(backFace, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 120}):Play()
            TweenService:Create(core, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 160}):Play()
            task.wait(1.2)

            TweenService:Create(frontFace, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 45}):Play()
            TweenService:Create(backFace, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 60}):Play()
            TweenService:Create(core, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {Rotation = 20}):Play()
            task.wait(1.2)
        end
    end)

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.62)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local textGradient = Instance.new("UIGradient")
    textGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(106,145,19)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20,21,23))
    })
    textGradient.Rotation = 0
    textGradient.Parent = label

    task.spawn(function()
        while label.Parent do
            TweenService:Create(
                textGradient,
                TweenInfo.new(2, Enum.EasingStyle.Linear),
                {Offset = Vector2.new(1, 0)}
            ):Play()
            task.wait(2)
            textGradient.Offset = Vector2.new(-1, 0)
            task.wait(0.1)
        end
    end)

    local particleFolder = Instance.new("Folder")
    particleFolder.Parent = bg

    local function spawnParticle()
        local p = Instance.new("Frame")
        p.Size = UDim2.new(0, math.random(2, 4), 0, math.random(2, 4))
        p.Position = UDim2.new(math.random(), 0, math.random(), 0)
        p.BackgroundColor3 = Color3.fromRGB(150, 255, 120)
        p.BackgroundTransparency = 0.85
        p.BorderSizePixel = 0
        p.Parent = particleFolder

        TweenService:Create(
            p,
            TweenInfo.new(math.random(3, 6), Enum.EasingStyle.Linear),
            {
                Position = UDim2.new(math.random(), 0, math.random(), 0),
                BackgroundTransparency = 1
            }
        ):Play()

        task.delay(6, function()
            if p then p:Destroy() end
        end)
    end

    task.spawn(function()
        while gui.Parent do
            spawnParticle()
            task.wait(0.12)
        end
    end)

    local function FadeOut()
        TweenService:Create(
            bg,
            TweenInfo.new(0.6, Enum.EasingStyle.Sine),
            {BackgroundTransparency = 1}
        ):Play()

        TweenService:Create(
            label,
            TweenInfo.new(0.6, Enum.EasingStyle.Sine),
            {TextTransparency = 1}
        ):Play()

        TweenService:Create(
            frontFace,
            TweenInfo.new(0.6, Enum.EasingStyle.Sine),
            {BackgroundTransparency = 1}
        ):Play()

        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

return CreateLoaderScreen
