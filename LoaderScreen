local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "TriquetraLoader"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    bg.Parent = gui

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.7)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamMedium
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local root = Instance.new("Frame")
    root.AnchorPoint = Vector2.new(0.5, 0.5)
    root.Position = UDim2.fromScale(0.5, 0.45)
    root.Size = UDim2.new(0, 140, 0, 140)
    root.BackgroundTransparency = 1
    root.Parent = bg

    local function makeArc()
        local arc = Instance.new("Frame")
        arc.AnchorPoint = Vector2.new(0.5, 0.5)
        arc.Position = UDim2.fromScale(0.5, 0.5)
        arc.Size = UDim2.new(0, 140, 0, 40)
        arc.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        arc.BorderSizePixel = 0
        return arc
    end

    local arcs = {}

    for i = 1, 3 do
        local arc = makeArc()
        arc.Rotation = (i - 1) * 120
        arc.Parent = root
        arcs[i] = arc
    end

    task.spawn(function()
        local active = 1
        while gui.Parent do
            for i = 1, 3 do
                arcs[i].BackgroundColor3 =
                    (i == active)
                    and Color3.fromRGB(0, 170, 255)
                    or Color3.fromRGB(60, 60, 60)
            end

            active = active % 3 + 1
            task.wait(0.5)
        end
    end)

    local function FadeOut()
        TweenService:Create(bg, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {BackgroundTransparency = 1}):Play()
        TweenService:Create(label, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {TextTransparency = 1}):Play()
        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

return CreateLoaderScreen
