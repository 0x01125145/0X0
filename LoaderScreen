local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "HubLoading"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    bg.Parent = gui

    local center = Instance.new("Frame")
    center.AnchorPoint = Vector2.new(0.5, 0.5)
    center.Position = UDim2.fromScale(0.5, 0.45)
    center.Size = UDim2.new(0, 160, 0, 160)
    center.BackgroundTransparency = 1
    center.Parent = bg

    local function createArc(sizeScale, thickness, color)
        local arc = Instance.new("Frame")
        arc.AnchorPoint = Vector2.new(0.5, 0.5)
        arc.Position = UDim2.fromScale(0.5, 0.5)
        arc.Size = UDim2.new(sizeScale, 0, sizeScale, 0)
        arc.BackgroundTransparency = 1
        arc.Parent = center

        local stroke = Instance.new("UIStroke")
        stroke.Thickness = thickness
        stroke.Color = color
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = arc

        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0,0,0)),
            ColorSequenceKeypoint.new(0.5, color),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0,0,0))
        })
        gradient.Rotation = 0
        gradient.Parent = arc

        return arc, gradient
    end

    local arc1, grad1 = createArc(1, 4, Color3.fromRGB(120, 255, 120))
    local arc2, grad2 = createArc(0.75, 3, Color3.fromRGB(80, 200, 80))
    local arc3, grad3 = createArc(0.5, 2, Color3.fromRGB(60, 150, 60))

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(grad1, TweenInfo.new(2, Enum.EasingStyle.Linear), {Rotation = grad1.Rotation + 360}):Play()
            TweenService:Create(grad2, TweenInfo.new(3, Enum.EasingStyle.Linear), {Rotation = grad2.Rotation - 360}):Play()
            TweenService:Create(grad3, TweenInfo.new(4, Enum.EasingStyle.Linear), {Rotation = grad3.Rotation + 360}):Play()
            task.wait(1)
        end
    end)

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.62)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local textGradient = Instance.new("UIGradient")
    textGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(120,255,120)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(40,60,40))
    })
    textGradient.Rotation = 0
    textGradient.Parent = label

    task.spawn(function()
        while label.Parent do
            TweenService:Create(textGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Offset = Vector2.new(1, 0)
            }):Play()
            task.wait(2)
            textGradient.Offset = Vector2.new(-1, 0)
            task.wait(0.1)
        end
    end)

    local function FadeOut()
        TweenService:Create(bg, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            BackgroundTransparency = 1
        }):Play()

        TweenService:Create(label, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            TextTransparency = 1
        }):Play()

        TweenService:Create(center, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()

        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

return CreateLoaderScreen
