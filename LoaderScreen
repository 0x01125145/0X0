local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "HubLoading"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
    bg.Parent = gui

    local scan = Instance.new("Frame")
    scan.Size = UDim2.fromScale(1, 1)
    scan.BackgroundTransparency = 1
    scan.Parent = bg

    local scanGrad = Instance.new("UIGradient")
    scanGrad.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0,0,0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(40,40,40)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0,0,0))
    })
    scanGrad.Rotation = 90
    scanGrad.Parent = scan

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(scanGrad, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Offset = Vector2.new(0, 1)
            }):Play()
            task.wait(2)
            scanGrad.Offset = Vector2.new(0, -1)
            task.wait(0.1)
        end
    end)

    local center = Instance.new("Frame")
    center.AnchorPoint = Vector2.new(0.5, 0.5)
    center.Position = UDim2.fromScale(0.5, 0.45)
    center.Size = UDim2.new(0, 80, 0, 80)
    center.BackgroundTransparency = 1
    center.Parent = bg

    local centerStroke = Instance.new("UIStroke")
    centerStroke.Thickness = 3
    centerStroke.Color = Color3.fromRGB(120, 255, 120)
    centerStroke.Transparency = 0.1
    centerStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    centerStroke.Parent = center

    local centerCorner = Instance.new("UICorner")
    centerCorner.CornerRadius = UDim.new(0, 999)
    centerCorner.Parent = center

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(centerStroke, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {
                Transparency = 0.3
            }):Play()
            task.wait(1.2)
            TweenService:Create(centerStroke, TweenInfo.new(1.2, Enum.EasingStyle.Sine), {
                Transparency = 0.1
            }):Play()
            task.wait(1.2)
        end
    end)

    local inner = Instance.new("Frame")
    inner.AnchorPoint = Vector2.new(0.5, 0.5)
    inner.Position = UDim2.fromScale(0.5, 0.45)
    inner.Size = UDim2.new(0, 110, 0, 110)
    inner.BackgroundTransparency = 1
    inner.Parent = bg

    local innerStroke = Instance.new("UIStroke")
    innerStroke.Thickness = 2
    innerStroke.Color = Color3.fromRGB(120, 255, 255)
    innerStroke.Transparency = 0.4
    innerStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    innerStroke.Parent = inner

    local innerCorner = Instance.new("UICorner")
    innerCorner.CornerRadius = UDim.new(0, 999)
    innerCorner.Parent = inner

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(inner, TweenInfo.new(4, Enum.EasingStyle.Linear), {
                Rotation = inner.Rotation + 360
            }):Play()
            task.wait(4)
        end
    end)

    local function spawnHex()
        local hex = Instance.new("Frame")
        hex.AnchorPoint = Vector2.new(0.5, 0.5)
        hex.Position = UDim2.fromScale(0.5, 0.45)
        hex.Size = UDim2.new(0, 80, 0, 80)
        hex.BackgroundTransparency = 1
        hex.Parent = bg

        local stroke = Instance.new("UIStroke")
        stroke.Thickness = 3
        stroke.Color = Color3.fromRGB(120, 255, 120)
        stroke.Transparency = 0
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = hex

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 999)
        corner.Parent = hex

        TweenService:Create(hex, TweenInfo.new(1.6, Enum.EasingStyle.Sine), {
            Size = UDim2.new(0, 260, 0, 260)
        }):Play()

        TweenService:Create(stroke, TweenInfo.new(1.6, Enum.EasingStyle.Sine), {
            Transparency = 1
        }):Play()

        task.delay(1.6, function()
            hex:Destroy()
        end)
    end

    task.spawn(function()
        while gui.Parent do
            spawnHex()
            task.wait(0.25)
        end
    end)

    task.spawn(function()
        while gui.Parent do
            TweenService:Create(centerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(120,255,120)
            }):Play()
            TweenService:Create(innerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(120,255,255)
            }):Play()
            task.wait(2)

            TweenService:Create(centerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(80,180,255)
            }):Play()
            TweenService:Create(innerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(60,140,255)
            }):Play()
            task.wait(2)

            TweenService:Create(centerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(160,120,255)
            }):Play()
            TweenService:Create(innerStroke, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Color = Color3.fromRGB(200,120,255)
            }):Play()
            task.wait(2)
        end
    end)

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.62)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local textGradient = Instance.new("UIGradient")
    textGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(120,255,120)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(40,60,40))
    })
    textGradient.Rotation = 0
    textGradient.Parent = label

    task.spawn(function()
        while label.Parent do
            TweenService:Create(textGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Offset = Vector2.new(1, 0)
            }):Play()
            task.wait(2)
            textGradient.Offset = Vector2.new(-1, 0)
            task.wait(0.1)
        end
    end)

    local function FadeOut()
        TweenService:Create(bg, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            BackgroundTransparency = 1
        }):Play()

        TweenService:Create(label, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            TextTransparency = 1
        }):Play()

        TweenService:Create(center, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()

        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

local particleFolder = Instance.new("Folder")
particleFolder.Parent = bg

local function spawnParticle()
    local p = Instance.new("Frame")
    p.Size = UDim2.new(0, math.random(2, 4), 0, math.random(2, 4))
    p.Position = UDim2.new(math.random(), 0, math.random(), 0)
    p.BackgroundColor3 = Color3.fromRGB(120, 255, 200)
    p.BackgroundTransparency = 0.85
    p.BorderSizePixel = 0
    p.Parent = particleFolder

    TweenService:Create(
        p,
        TweenInfo.new(math.random(3, 6), Enum.EasingStyle.Linear),
        {
            Position = UDim2.new(math.random(), 0, math.random(), 0),
            BackgroundTransparency = 1
        }
    ):Play()

    task.delay(6, function()
        if p then p:Destroy() end
    end)
end

task.spawn(function()
    while gui.Parent do
        spawnParticle()
        task.wait(0.12)
    end
end)

return CreateLoaderScreen
