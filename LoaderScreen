local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function CreateLoaderScreen(text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Name = "HubLoading"
    gui.Parent = playerGui

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1, 1)
    bg.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
    bg.Parent = gui

    local particleFolder = Instance.new("Folder")
    particleFolder.Parent = bg

    local function spawnTinyParticle()
        local p = Instance.new("Frame")
        p.Size = UDim2.new(0, math.random(2, 4), 0, math.random(2, 4))
        p.Position = UDim2.new(math.random(), 0, math.random(), 0)
        p.BackgroundColor3 = Color3.fromRGB(120, 255, 200)
        p.BackgroundTransparency = 0.85
        p.BorderSizePixel = 0
        p.Parent = particleFolder

        TweenService:Create(
            p,
            TweenInfo.new(math.random(3, 6), Enum.EasingStyle.Linear),
            {
                Position = UDim2.new(math.random(), 0, math.random(), 0),
                BackgroundTransparency = 1
            }
        ):Play()

        task.delay(6, function()
            if p then p:Destroy() end
        end)
    end

    task.spawn(function()
        while gui.Parent do
            spawnTinyParticle()
            task.wait(0.12)
        end
    end)

    local luminanceFolder = Instance.new("Folder")
    luminanceFolder.Parent = bg

    local function spawnLuminanceOrb()
        local size = math.random(40, 90)
        local orb = Instance.new("Frame")
        orb.AnchorPoint = Vector2.new(0.5, 0.5)
        orb.Position = UDim2.new(math.random(), 0, math.random(), 0)
        orb.Size = UDim2.new(0, size, 0, size)
        orb.BackgroundColor3 = Color3.fromRGB(120, 255, 200)
        orb.BackgroundTransparency = 0.9
        orb.BorderSizePixel = 0
        orb.Parent = luminanceFolder

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 999)
        corner.Parent = orb

        TweenService:Create(
            orb,
            TweenInfo.new(math.random(4, 7), Enum.EasingStyle.Sine),
            {
                Position = UDim2.new(math.random(), 0, math.random(), 0),
                BackgroundTransparency = 1
            }
        ):Play()

        task.spawn(function()
            while orb.Parent do
                TweenService:Create(orb, TweenInfo.new(1.8, Enum.EasingStyle.Sine), {
                    BackgroundTransparency = 0.85
                }):Play()
                task.wait(1.8)
                TweenService:Create(orb, TweenInfo.new(1.8, Enum.EasingStyle.Sine), {
                    BackgroundTransparency = 0.95
                }):Play()
                task.wait(1.8)
            end
        end)

        task.delay(7, function()
            if orb then orb:Destroy() end
        end)
    end

    task.spawn(function()
        while gui.Parent do
            spawnLuminanceOrb()
            task.wait(0.4)
        end
    end)

    local label = Instance.new("TextLabel")
    label.AnchorPoint = Vector2.new(0.5, 0)
    label.Position = UDim2.fromScale(0.5, 0.62)
    label.Size = UDim2.new(0, 400, 0, 40)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Text = text or "Loading..."
    label.Parent = bg

    local textGradient = Instance.new("UIGradient")
    textGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(120,255,200)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(40,60,40))
    })
    textGradient.Rotation = 0
    textGradient.Parent = label

    task.spawn(function()
        while label.Parent do
            TweenService:Create(textGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Offset = Vector2.new(1, 0)
            }):Play()
            task.wait(2)
            textGradient.Offset = Vector2.new(-1, 0)
            task.wait(0.1)
        end
    end)

    local function FadeOut()
        TweenService:Create(bg, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            BackgroundTransparency = 1
        }):Play()

        TweenService:Create(label, TweenInfo.new(0.6, Enum.EasingStyle.Sine), {
            TextTransparency = 1
        }):Play()

        task.wait(0.6)
        gui:Destroy()
    end

    return gui, FadeOut
end

return CreateLoaderScreen
